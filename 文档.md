# RPA 自动化工具详细开发文档

## 1. 项目愿景
开发一个基于 **Python + PySide6** 的现代化 RPA 工具，支持通过**可视化拖拽**快速构建自动化流程。不仅支持传统的图像识别，还集成深度网页自动化功能，实现精准、高效的流程编排。

---

## 2. 核心交互：拖拽式脚本编辑器
为了提升用户体验，脚本编辑区将采用类似“流程图”或“列表拖拽”的交互模式：

### 2.1 UI 拖拽功能
*   **左侧组件库**：包含“点击”、“输入”、“打开网页”、“判断”、“循环”等原子操作。用户可将组件拖入中间的执行序列。
*   **序列重排**：支持在执行序列中通过拖拽调整步骤的先后顺序。
*   **拖拽参数化**：支持将元素库中的图片或变量直接拖拽到步骤的参数输入框中。

### 2.2 RPA 模拟拖拽动作
*   **功能描述**：支持模拟鼠标从坐标 A 拖动到坐标 B，或从元素 A 拖动到元素 B。
*   **应用场景**：处理滑块验证码、文件移动、UI 元素排序等。

---

## 3. 深度网页自动化 (Web Automation)
不再局限于简单的“打开网页”，将引入更细致的网页元素控制。

### 3.1 网页操作清单
*   **精准输入**：针对指定的选择器（CSS/XPath）清除并输入文本。
*   **属性获取**：提取特定元素的文本、Href 链接、Value 值或图片地址。
*   **页面状态监控**：
    *   等待元素出现（Wait for Selector）。
    *   页面加载完成检测。
    *   处理 JavaScript 弹窗。
*   **Cookie 与 Session 管理**：支持保存登录状态，避免重复登录。

---

## 4. 元素选择与识别逻辑 (核心重点)
系统提供“图像匹配”与“网页 DOM 识别”的双重方案。

### 4.1 网页元素自动拾取 (Automatic Selector)
*   **拾取器模式**：用户点击“选择元素”后，程序呼出一个透明遮罩层或内置浏览器窗口。
*   **实时高亮**：当鼠标划过网页元素时，自动高亮当前元素并显示其标签（如 `div#login_btn`）。
*   **智能建议**：自动生成最优的 CSS Selector 或 XPath，并允许用户在下拉框中切换备选方案。

### 4.2 图像手动截取 (Manual Snapshot)
*   **截图工具**：内置类似 QQ/微信的截图功能，用户手动划定屏幕区域。
*   **自动锚点**：支持设置点击位置偏移量（例如：识别到文字，但点击文字右侧 20px 的输入框）。

### 4.3 统一元素库 (Element Library)
*   **混合存储**：元素库不仅保存图片，还保存网页选择器字符串。
*   **版本管理**：如果网页更新导致选择器失效，用户只需在元素库更新一次，所有引用该元素的脚本步聚将同步生效。

---

## 5. 逻辑控制与数据处理
*   **数据结构**：
    *   **变量**：支持创建全局变量或脚本局部变量。
    *   **列表/字典**：支持读取 Excel 或 CSV 数据并存入列表，实现循环批量操作。
*   **If/Else 分支**：
    *   基于图像是否存在判断。
    *   基于网页元素文本内容判断。
    *   基于变量值判断。

---

## 6. 技术架构补充
*   **浏览器引擎**：采用 `Playwright` 或 `Selenium` 的原生驱动，支持 Chromium 内核，确保对现代 Web 应用（React/Vue/Angular）的完美兼容。
*   **多线程模型**：UI 界面运行在主线程，自动化逻辑运行在 Worker 线程，通过信号 (Signal) 实时回传执行进度和日志，确保界面不卡顿且可随时中止任务。

---

## 7. 文件组织规范
```text
/Project_Root
  /data
    /elements      # 元素库数据 (JSON + Images)
    /scripts       # 脚本逻辑 (JSON)
  /engine          # 自动化核心逻辑 (Playwright/OpenCV 封装)
  /ui              # PySide6 界面组件
  /utils           # 截图、日志、配置读取等工具类
  main.exe         # 最终打包的单文件
```

---

## 8. 打包发布要求
*   使用 `PyInstaller` 结合 `--add-data` 确保 Playwright 驱动、OpenCV 依赖及静态图标资源正确打包。
*   实现资源路径的动态解析代码，确保 EXE 在任何目录下运行都不会丢失图片。
